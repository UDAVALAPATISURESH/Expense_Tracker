<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
</head>
<body>
  <h2>Welcome to Dashboard ðŸŽ‰</h2>
  <p>You logged in successfully.</p>

  <!-- Add Expense Form -->
  <form id="expenseForm">
    <label>Amount:</label><br>
    <input type="number" id="amount" required><br><br>

    <label>Description:</label><br>
    <input type="text" id="description" required><br><br>

    <label>Category:</label><br>
    <select id="category">
      <option value="food">Food</option>
      <option value="travel">Travel</option>
      <option value="shopping">Shopping</option>
    </select><br><br>

    <button type="submit">Add Expense</button>
  </form>

  <h3>Your Expenses:</h3>
  <ul id="expenseList"></ul>

  <script>
    const userId = localStorage.getItem("userId");
    if (!userId) {
      alert("Please login first!");
      window.location.href = "login.html";
    }

    const expenseForm = document.getElementById("expenseForm");
    const expenseList = document.getElementById("expenseList");

    // âœ… Add Expense
    expenseForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const expense = {
        amount: document.getElementById("amount").value,
        description: document.getElementById("description").value,
        category: document.getElementById("category").value,
        userId
      };

      try {
        const res = await fetch("http://localhost:3000/expense/add", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(expense)
        });

        const data = await res.json();
        if (res.ok) {
          alert("Expense added successfully âœ…");
          loadExpenses();
        } else {
          alert(data.message || "Error adding expense");
        }
      } catch (err) {
        alert("Something went wrong");
      }
    });

    // âœ… Load Expenses
    async function loadExpenses() {
      try {
        const res = await fetch("http://localhost:3000/expense/all?userId=" + userId);
        const data = await res.json();

        expenseList.innerHTML = "";
        data.forEach(expense => {
          const li = document.createElement("li");
          li.textContent = `${expense.amount} - ${expense.description} (${expense.category})`;
          expenseList.appendChild(li);
        });
      } catch (err) {
        console.log(err);
      }
    }

    loadExpenses();
  </script>
</body>
</html>
